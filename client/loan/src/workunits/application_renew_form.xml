<workunit>
    <invokers>
        <!--
        <invoker folderid="menu/services/loan" caption="Loan Renewal" target="window" permission="application.renew" index="1"/>
        -->
    </invokers>
    <code>
        <![CDATA[
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.util.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.reports.*;
        import com.rameses.common.*;
        import java.io.*;
        import com.rameses.io.*;
        
        class LoanRenewFormController {
            @Binding
            def binding;
            
            @Service( "LoanApplicationService" )
            def svc;
            
            def appno;
            def entity=[:];
            
            
            def renewApplication(){
                entity.putAll(svc.readByAppNo([appno:appno]));
                entity.state=null;
                entity.dtfiled=null;
                entity.approvedate=null;
                entity.amountapproved=null;
                entity.loaninfo=[interestrate:20];
                entity.comments=[];
                entity.tempObjid="APP"+new java.rmi.server.UID();

                clearComments("propertylist");
                clearComments("appliancelist");
                clearComments("vehiclelist");
                clearComments("attachmentslist");
                clearComments("otherslist");
                
                return InvokerUtil.lookupOpener("application:formActions",[    
                //return InvokerUtil.lookupOpener("loan:applicationform",[
                            selectHandler:{o->
                                appno="";
                                binding.refresh("appno");
                                binding.focus("appno");
                            },
                            entity:entity,mode:"renew"]);
            }
            
            void clearComments(def o){
                entity[o].each(){
                    if (it.comments.size()>0) it.comments=[];
                }
            }
            /*
            void renewApplication(){
                entity.putAll(svc.readByAppNo([appno:entity.appno]));
                entity.state=null;
                entity.dtfiled=null;
                entity.approvedate=null;
                entity.amountapproved=null;
                entity.loaninfo=[interestrate:20];
                entity.comments=[];
                entity.tempObjid="APP"+new java.rmi.server.UID();

                clearAssetComments("propertylist");
                clearAssetComments("appliancelist");
                clearAssetComments("vehiclelist");
                
                //mode = "renew";
                //init();
            }*/
        }
       ]]>
    </code>
    <pages>
        <page template="loan.renew.ui.LoanRenewForm"/>
    </pages>
</workunit>