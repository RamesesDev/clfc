<workunit>
    <invokers>
        <invoker type="application:waiveLedger" caption="Waive Ledger" target="popup" action="init"/>
    </invokers>
    <code>
        <![CDATA[
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        
        public class WaiveLedgerController 
        {
            @Service('LoanLedgerService')
            def svc;
        
            def waiver = [:];
            
            //-- passed by the caller
            def appid;
            def borrowername;
            def handler;
            
            void init(){    
               
                waiver = [  date: OsirisContext.env.LOCALE_TIME,
                            //amount: ,
                            //dtapproved: approvedate,
                            approvedby: OsirisContext.env.USERINFO.firstname+ ' '+OsirisContext.env.USERINFO.lastname
                          ];
                
            }    
            
            def save() {
                if( MsgBox.confirm('You are about to waive this ledger.\nPlease verify that all entries are correct. Proceed?') ) 
                {
                    waiver.appid = appid;
                    def ledger = svc.waive( waiver );
                    if( handler ) handler( ledger );
                    return '_close';
                }
                return null;
            }
        }
       ]]>
    </code>
    <pages>
        <page template="loan.ui.ledger.WaiverPage"/>
    </pages>
</workunit>